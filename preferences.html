<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Preferences | Weekplan.ai</title>
<link rel="stylesheet" href="/styles.css" />
<style>
  :root{
    --ink:#0b1220; --bg:#0b1220; --muted:#9fb1c3;
    --accent:#6d7cff; --accent2:#3dd1c0; --panel: #0e1624; --border:rgba(255,255,255,.12);
  }
  html,body{height:100%;margin:0}
  body{
    display:grid;place-items:center;background:
      radial-gradient(1200px 600px at 90% -10%, rgba(109,124,255,.18), transparent 60%),
      radial-gradient(900px 520px at -10% 95%, rgba(61,209,192,.18), transparent 60%),
      var(--bg);
    color:#e8edf3;font:16px/1.4 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  /* Hero */
  .hero{text-align:center;max-width:640px;padding:24px}
  .logo{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:6px;opacity:.95}
  .dot{width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,#7c8aff,#3dd1c0)}
  h1{margin:.2rem 0 0;font-size:32px;letter-spacing:-.02em}
  p.sub{margin:.4rem 0 1.2rem;color:#cbd6e2}
  .cta{
    border:0;cursor:pointer;padding:16px 22px;border-radius:16px;font-weight:900;
    background:linear-gradient(135deg,#7c8aff 0%, #3dd1c0 100%);
    color:#06101c;box-shadow:0 18px 50px rgba(86,144,255,.35);transition:transform .12s ease;
  }
  .cta:active{transform:translateY(1px)}
  .tinylink{margin-top:10px;color:#a9b8ff;text-decoration:underline;cursor:pointer;font-size:.9rem}

  /* Modal (dialog) */
  dialog{width:100%;max-width:560px;margin:0 auto;border:0;padding:0;background:transparent}
  dialog::backdrop{background:rgba(2,6,12,.55);backdrop-filter:blur(2px)}
  .sheet{
    background:rgba(14,22,36,.92); border:1px solid var(--border); border-radius:22px;
    box-shadow:0 30px 80px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.06);
    overflow:hidden;
  }
  .head{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 6px}
  .title{font-weight:900}
  .close{border:1px solid var(--border);background:transparent;color:#dfe8ff;border-radius:12px;padding:8px 10px;cursor:pointer}
  .body{padding:8px 16px 16px}
  .muted{color:#b6c5d5;font-size:.92rem}

  /* Inputs */
  textarea,input[type="text"],select{
    width:100%;border:1px solid var(--border);background:#0a1322;color:#e8f1ff;
    border-radius:14px;padding:12px;outline:none;
  }
  textarea::placeholder, input::placeholder{color:#8aa0b5}
  .checks{display:grid;gap:10px;margin-top:10px}
  .check{
    display:flex;align-items:center;gap:10px;background:#0b1526;border:1px solid var(--border);
    padding:10px 12px;border-radius:12px;
  }
  .row{display:grid;gap:10px}
  .row.two{grid-template-columns:1fr 1fr}
  .btn{
    border:0;cursor:pointer;padding:12px 16px;border-radius:14px;font-weight:800;
  }
  .btn.primary{background:linear-gradient(135deg,#7c8aff,#3dd1c0);color:#06101c}
  .btn.alt{background:#0b1526;color:#dfe8ff;border:1px solid var(--border)}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}

  /* Chips + sliders for wizard */
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--border);background:#0a1322;color:#d7e7ff;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
  .chip[aria-pressed="true"]{background:#0f2339;border-color:#3dd1c0;box-shadow:0 6px 16px rgba(61,209,192,.15)}
  .sliderOut{color:#b6c5d5;font-size:.9rem;margin-top:4px}

  /* Wizard */
  .progress{height:6px;background:#0a1322;border:1px solid var(--border);border-radius:999px;overflow:hidden}
  .progress .bar{height:100%;width:0;background:linear-gradient(90deg,#7c8aff,#3dd1c0);transition:width .35s cubic-bezier(.22,1,.36,1)}
  .step{display:none}
  .step.show{display:block;animation:fade .22s ease-out}
  @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

  /* JSON peek */
  details.peek{margin-top:10px}
  details.peek .box{
    font-family:ui-monospace,Menlo,Consolas,monospace;white-space:pre-wrap;background:#061023;color:#e6eef9;
    border:1px solid var(--border);border-radius:14px;padding:12px;max-height:200px;overflow:auto
  }
</style>
</head>
<body>

  <!-- HERO -->
  <section class="hero">
    <div class="logo"><span class="dot"></span><strong>Weekplan.ai</strong></div>
    <h1>Ready to eat smarter?</h1>
    <p class="sub">We‚Äôll build a dinner weekplan based on your vibe. Start simple‚Äîdetails come later.</p>
    <button class="cta" id="getStarted">Get started</button>
    <div class="tinylink" id="peekJSON">Preview JSON (dev)</div>
  </section>

  <!-- QUICK MODAL -->
  <dialog id="quickDialog">
    <div class="sheet">
      <div class="head">
        <div class="title">Quick preferences</div>
        <button class="close" data-close>Close</button>
      </div>
      <div class="body">
        <label class="muted">Optional note</label>
        <textarea id="quickNote" placeholder="e.g., 20-min dinners, love Mediterranean, no mushrooms"></textarea>

        <div class="muted" style="margin-top:10px">Pick any that fit (optional)</div>
        <div class="checks">
          <label class="check"><input type="checkbox" value="save_time"> <span>Save time</span></label>
          <label class="check"><input type="checkbox" value="weight_loss"> <span>Weight loss</span></label>
          <label class="check"><input type="checkbox" value="muscle_gain"> <span>Muscle gain</span></label>
          <label class="check"><input type="checkbox" value="vegetarian"> <span>Vegetarian focus</span></label>
          <label class="check"><input type="checkbox" value="budget_friendly"> <span>Budget friendly</span></label>
        </div>

        <div class="actions">
          <button class="btn primary" id="quickCreate">Create Plan</button>
          <button class="btn alt" id="openWizard">Help me find my perfect food plan</button>
        </div>

        <details class="peek" id="quickPeek">
          <summary class="muted">JSON preview</summary>
          <div class="box" id="quickJSON">{ }</div>
        </details>
      </div>
    </div>
  </dialog>

  <!-- WIZARD MODAL -->
  <dialog id="wizardDialog">
    <div class="sheet">
      <div class="head">
        <div class="title">Find your perfect plan</div>
        <button class="close" data-close>Close</button>
      </div>
      <div class="body">
        <div class="progress" style="margin-bottom:10px"><div class="bar" id="wBar"></div></div>

        <!-- Step 1: Goals -->
        <div class="step show" data-step="1">
          <h3>üéØ Goals</h3>
          <p class="muted">Tap a few that matter</p>
          <div class="chips" id="goalsChips"></div>
          <input id="goalsFree" placeholder="Add a goal (Enter)" />
        </div>

        <!-- Step 2: Diet & Rules -->
        <div class="step" data-step="2">
          <h3>ü•ó Diet & rules</h3>
          <div class="muted">Diet style</div>
          <div class="chips" id="dietChips"></div>

          <div class="muted" style="margin-top:10px">Allergies (tap to toggle)</div>
          <div class="chips" id="allergyChips"></div>
          <input id="allergyFree" placeholder="Add allergy (Enter)" />

          <div class="muted" style="margin-top:10px">Never show</div>
          <div class="chips" id="avoidChips"></div>
          <input id="avoidFree" placeholder="Add item to avoid (Enter)" />

          <div class="muted" style="margin-top:10px">Must include</div>
          <div class="chips" id="mustChips"></div>
          <input id="mustFree" placeholder="Add must-include (Enter)" />
        </div>

        <!-- Step 3: Time & Skill -->
        <div class="step" data-step="3">
          <h3>‚è±Ô∏è Time & skill</h3>
          <div class="muted">Time per dinner</div>
          <div class="chips" id="timeChips"></div>

          <div class="muted" style="margin-top:10px">Variety vs repetition</div>
          <input id="variety" type="range" min="0" max="10" value="7" />
          <div class="sliderOut">Variety: <span id="varietyOut">7</span>/10</div>

          <div class="muted" style="margin-top:10px">Skill ‚Ä¢ Budget ‚Ä¢ Leftovers ‚Ä¢ Servings</div>
          <div class="chips" id="skillChips"></div>
          <div class="chips" id="budgetChips"></div>
          <div class="chips" id="leftoverChips"></div>
          <div class="chips" id="servingChips"></div>
        </div>

        <!-- Step 4: Taste & Cuisines -->
        <div class="step" data-step="4">
          <h3>üçΩÔ∏è Taste & cuisines</h3>
          <div class="muted">Cuisines you like</div>
          <div class="chips" id="cuisineChips"></div>
          <input id="cuisineFree" placeholder="Add cuisine (Enter)" />
          <div class="muted" style="margin-top:10px">Spice tolerance</div>
          <input id="spice" type="range" min="0" max="10" value="5" />
          <div class="sliderOut">Spice: <span id="spiceOut">5</span>/10</div>
          <div class="muted" style="margin-top:10px">Desserts & Proteins</div>
          <div class="chips" id="dessertChips"></div>
          <div class="chips" id="proteinChips"></div>
          <input id="proteinFree" placeholder="Add protein (Enter)" />
        </div>

        <!-- Step 5: Equipment -->
        <div class="step" data-step="5">
          <h3>üîß Equipment (optional)</h3>
          <div class="chips" id="equipChips"></div>
          <input id="equipFree" placeholder="Add equipment (Enter)" />
        </div>

        <div class="actions">
          <button class="btn alt" id="wBack">Back</button>
          <button class="btn primary" id="wNext">Next</button>
          <button class="btn primary" id="wCreate" style="display:none">Create Plan</button>
        </div>

        <details class="peek">
          <summary class="muted">JSON preview</summary>
          <div class="box" id="wizJSON">{ }</div>
        </details>
      </div>
    </div>
  </dialog>

<script>
/* ---------- minimal state (no backend) ---------- */
const PRESETS = {
  goals:['save_time','weight_loss','muscle_gain','enjoyment','learn_to_cook','consistency'],
  diet:['omnivore','vegetarian','vegan','pescatarian','flexitarian','keto','mediterranean'],
  allergies:['peanuts','lactose','gluten','shellfish','soy','eggs'],
  avoid:['mushrooms','olives','cilantro'],
  must:['chicken','rice','beans'],
  time:['‚â§20 min','~30 min','45+ min'],
  skill:['beginner','intermediate','advanced'],
  budget:['low','medium','high'],
  leftovers:['none','ok_for_lunch','prefer_leftovers'],
  servings:['1','2','4'],
  cuisines:['mediterranean','mexican','italian','indian','thai','japanese','nordic'],
  dessert:['allow','no'],
  proteins:['chicken','fish','salmon','tofu','lentils','beans','eggs'],
  equipment:['stovetop','oven','microwave','air_fryer','slow_cooker','blender','pressure_cooker']
};

let state = {
  profileVersion:1,
  quickNote:'',
  goals:[],
  dietary:{ dietStyle:'omnivore', allergies:[], intolerances:[], avoid:[], mustInclude:[] },
  taste:{ cuisines:[], spiceTolerance:5, allowDesserts:true, proteinPrefs:[] },
  mealRules:{ focusMeals:'dinner', servingsPerRecipe:2, leftoversPolicy:'none', timePerDinnerMin:30, varietyLevel:7 },
  skillBudget:{ skillLevel:'beginner', budgetLevel:'medium', equipment:[] },
  meta:{ device:'web', savedAt:null }
};

const $ = s => document.querySelector(s);

/* ----- Landing actions ----- */
$('#getStarted').onclick = ()=> $('#quickDialog').showModal();
$('#peekJSON').onclick = ()=> alert(JSON.stringify(exportObj(), null, 2));

/* Close buttons */
document.querySelectorAll('[data-close]').forEach(b=> b.onclick = e => e.target.closest('dialog').close());

/* ----- Quick modal ----- */
const quickDialog = $('#quickDialog');
const quickChecks = Array.from(quickDialog.querySelectorAll('input[type="checkbox"]'));
$('#quickCreate').onclick = ()=>{
  // map quick checkboxes into goals/diet flags
  const chosen = quickChecks.filter(c=>c.checked).map(c=>c.value);
  state.quickNote = $('#quickNote').value.trim();
  state.goals = chosen.filter(v=>['save_time','weight_loss','muscle_gain'].includes(v));
  if(chosen.includes('vegetarian')) state.dietary.dietStyle='vegetarian';
  if(chosen.includes('budget_friendly')) state.skillBudget.budgetLevel='low';
  updateJSONViews();
  $('#quickPeek').open = true;
  alert('Plan ready (demo). Use JSON preview to inspect.');
};

$('#openWizard').onclick = ()=>{
  // seed from quick choices
  const chosen = quickChecks.filter(c=>c.checked).map(c=>c.value);
  state.quickNote = $('#quickNote').value.trim();
  if(chosen.includes('vegetarian')) state.dietary.dietStyle='vegetarian';
  if(chosen.includes('budget_friendly')) state.skillBudget.budgetLevel='low';
  if(chosen.includes('save_time') && !state.goals.includes('save_time')) state.goals.push('save_time');
  updateJSONViews();
  $('#wizardDialog').showModal();
};

/* ----- Wizard ----- */
const steps = Array.from(document.querySelectorAll('#wizardDialog .step'));
let cur = 1;
const total = steps.length;
const wBar = $('#wBar');
function showStep(n){
  cur = Math.max(1, Math.min(total, n));
  steps.forEach(s=> s.classList.toggle('show', +s.dataset.step===cur));
  wBar.style.width = ((cur-1)/(total-1))*100 + '%';
  $('#wBack').style.visibility = (cur===1) ? 'hidden' : 'visible';
  $('#wNext').style.display  = (cur===total) ? 'none'   : 'inline-block';
  $('#wCreate').style.display= (cur===total) ? 'inline-block' : 'none';
}
$('#wBack').onclick = ()=> showStep(cur-1);
$('#wNext').onclick = ()=> showStep(cur+1);
$('#wCreate').onclick = ()=>{
  state.meta.savedAt = new Date().toISOString();
  updateJSONViews();
  alert('Plan ready (demo).');
};

/* Chips builder */
function chipField(containerId, targetArr, preset){
  const c = $('#'+containerId);
  const render=()=>{
    c.innerHTML='';
    const list=[...new Set([...preset, ...targetArr])];
    list.forEach(v=>{
      const b=document.createElement('button');
      b.type='button'; b.className='chip'; b.textContent=v;
      b.setAttribute('aria-pressed', String(targetArr.includes(v)));
      b.onclick=()=>{ const i=targetArr.indexOf(v); if(i>=0) targetArr.splice(i,1); else targetArr.push(v); render(); updateJSONViews(); };
      c.appendChild(b);
    });
  };
  render();
  return { render };
}
function addOnEnter(inputId, arr, containerId){
  $('#'+inputId).addEventListener('keydown', e=>{
    if(e.key==='Enter'){
      e.preventDefault();
      const v=e.currentTarget.value.trim().toLowerCase();
      if(v && !arr.includes(v)){ arr.push(v); e.currentTarget.value=''; chipField(containerId, arr, []).render(); updateJSONViews(); }
    }
  });
}

/* Build wizard fields */
chipField('goalsChips', state.goals, PRESETS.goals);
addOnEnter('goalsFree', state.goals, 'goalsChips');

const dietSel = chipField('dietChips', [state.dietary.dietStyle], PRESETS.diet);
$('#dietChips').addEventListener('click', e=>{
  const v = e.target.textContent;
  if(PRESETS.diet.includes(v)){ state.dietary.dietStyle = v; dietSel.render(); updateJSONViews(); }
});

chipField('allergyChips', state.dietary.allergies, PRESETS.allergies);
addOnEnter('allergyFree', state.dietary.allergies, 'allergyChips');

chipField('avoidChips', state.dietary.avoid, PRESETS.avoid);
addOnEnter('avoidFree', state.dietary.avoid, 'avoidChips');

chipField('mustChips', state.dietary.mustInclude, PRESETS.must);
addOnEnter('mustFree', state.dietary.mustInclude, 'mustChips');

const timeMap = {'‚â§20 min':20,'~30 min':30,'45+ min':45};
const timeSel = chipField('timeChips', [], PRESETS.time);
$('#timeChips').addEventListener('click', e=>{
  const v=e.target.textContent; if(!PRESETS.time.includes(v)) return;
  state.mealRules.timePerDinnerMin = timeMap[v];
  // single-select styling
  Array.from($('#timeChips').children).forEach(b=>b.setAttribute('aria-pressed', String(b.textContent===v)));
  updateJSONViews();
});

chipField('skillChips', [state.skillBudget.skillLevel], PRESETS.skill);
$('#skillChips').addEventListener('click', e=>{
  const v=e.target.textContent;if(PRESETS.skill.includes(v)){ state.skillBudget.skillLevel=v; chipField('skillChips',[v],PRESETS.skill); updateJSONViews();}
});

chipField('budgetChips', [state.skillBudget.budgetLevel], PRESETS.budget);
$('#budgetChips').addEventListener('click', e=>{
  const v=e.target.textContent;if(PRESETS.budget.includes(v)){ state.skillBudget.budgetLevel=v; chipField('budgetChips',[v],PRESETS.budget); updateJSONViews();}
});

chipField('leftoverChips', [state.mealRules.leftoversPolicy], PRESETS.leftovers);
$('#leftoverChips').addEventListener('click', e=>{
  const v=e.target.textContent;if(PRESETS.leftovers.includes(v)){ state.mealRules.leftoversPolicy=v; chipField('leftoverChips',[v],PRESETS.leftovers); updateJSONViews();}
});

chipField('servingChips', [String(state.mealRules.servingsPerRecipe)], PRESETS.servings);
$('#servingChips').addEventListener('click', e=>{
  const v=e.target.textContent;if(PRESETS.servings.includes(v)){ state.mealRules.servingsPerRecipe=+v; chipField('servingChips',[v],PRESETS.servings); updateJSONViews();}
});

chipField('cuisineChips', state.taste.cuisines, PRESETS.cuisines);
addOnEnter('cuisineFree', state.taste.cuisines, 'cuisineChips');

$('#variety').addEventListener('input', e=>{
  state.mealRules.varietyLevel=+e.target.value; $('#varietyOut').textContent=e.target.value; updateJSONViews();
});
$('#spice').addEventListener('input', e=>{
  state.taste.spiceTolerance=+e.target.value; $('#spiceOut').textContent=e.target.value; updateJSONViews();
});

const dessertSel = chipField('dessertChips', [state.taste.allowDesserts?'allow':'no'], PRESETS.dessert);
$('#dessertChips').addEventListener('click', e=>{
  const v=e.target.textContent;
  if(PRESETS.dessert.includes(v)){ state.taste.allowDesserts = (v==='allow'); dessertSel.render(); updateJSONViews(); }
});

chipField('proteinChips', state.taste.proteinPrefs, PRESETS.proteins);
addOnEnter('proteinFree', state.taste.proteinPrefs, 'proteinChips');

chipField('equipChips', state.skillBudget.equipment, PRESETS.equipment);
addOnEnter('equipFree', state.skillBudget.equipment, 'equipChips');

/* JSON builders */
function exportObj(){
  return {
    profileVersion:1,
    quickNote: state.quickNote,
    goals:[...state.goals],
    dietary:{ ...state.dietary },
    taste:{ ...state.taste, allowDesserts: !!state.taste.allowDesserts },
    mealRules:{ ...state.mealRules },
    skillBudget:{ ...state.skillBudget },
    meta:{ device:'web', savedAt:new Date().toISOString() }
  };
}
function updateJSONViews(){
  $('#quickJSON').textContent = JSON.stringify(exportObj(), null, 2);
  $('#wizJSON').textContent   = JSON.stringify(exportObj(), null, 2);
}

/* Start wizard at step 1 */
showStep(1);
updateJSONViews();

/* Keep JSON updated from quick modal textarea live */
$('#quickNote').addEventListener('input', e=>{ state.quickNote = e.target.value.trim(); updateJSONViews(); });

</script>
</body>
</html>

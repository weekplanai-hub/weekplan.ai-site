<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>API Manager ‚Äî Single Page</title>
  <style>
    :root{
      --bg:#f6f7fb; --panel:#fff; --text:#0f172a; --muted:#64748b;
      --accent:#1a73e8; --ring:rgba(26,115,232,.2); --border:#e5e7eb;
      --ok:#16a34a; --err:#ef4444; --shadow:0 12px 34px rgba(0,0,0,.06);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text);
      font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    a{color:inherit;text-decoration:none}
    
    /* Navigation */
    header{background:#f9fafb; border-bottom:1px solid #e5e7eb;}
    .nav{
      max-width:1200px; margin:0 auto; padding:20px 20px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{font-weight:800; font-size:20px; letter-spacing:.2px; display:flex; align-items:center; gap:8px;}
    .back-link{
      color:#6b7280; text-decoration:none; font-weight:500;
      padding:8px 16px; border-radius:6px; transition:all .2s;
    }
    .back-link:hover{ color:#2563eb; background:#eff6ff; }

    
    /* Layout */
    main{max-width:1200px; margin:0 auto; padding:20px 16px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:20px; margin-bottom:16px}
    .head{display:flex; align-items:center; gap:12px; margin-bottom:12px}
    .head .title{font-weight:800; font-size:18px}
    .muted{color:var(--muted)}
    
    /* Form elements */
    .form-row{display:grid; grid-template-columns:140px 1fr 160px; gap:12px; align-items:end; margin-bottom:8px}
    .form-group{display:flex; flex-direction:column; gap:4px}
    label{font-weight:600; font-size:14px}
    input, select, textarea{width:100%; padding:10px 12px; border-radius:8px; border:1px solid var(--border);
      background:#fff; font-size:14px}
    input:focus, select:focus, textarea:focus{outline:2px solid var(--ring); outline-offset:2px}
    textarea{min-height:120px; resize:vertical; font-family:ui-monospace, Monaco, 'Courier New', monospace}
    
    /* Buttons */
    .btn{display:inline-flex; gap:8px; align-items:center; justify-content:center; padding:10px 16px;
      border-radius:8px; border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:500;
      transition:all .15s ease}
    .btn:hover{box-shadow:var(--shadow)}
    .btn.primary{background:var(--accent); color:#fff; border-color:var(--accent)}
    .btn.ghost{background:transparent; color:var(--accent); border-color:var(--accent)}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    /* Back button ‚Äî identical to index.html outline button */
    header .back-btn{
      padding:16px 32px;
      font-size:1.1rem;
      font-weight:600;
      border-radius:8px;
      transition:all .2s;
      background:transparent;
      color:#2563eb;
      border:2px solid #2563eb;
    }
    header .back-btn:hover{
      background:#2563eb;
      color:#fff;
      transform:translateY(-1px);
    }

    /* Status */

    .status{display:flex; align-items:center; gap:8px; padding:8px 0; font-size:14px}
    .dot{width:8px; height:8px; border-radius:50%; background:var(--muted)}
    .status.loading .dot{background:var(--accent); animation:pulse 1.5s infinite}
    .status.ok{color:var(--ok)} .status.ok .dot{background:var(--ok)}
    .status.error{color:var(--err)} .status.error .dot{background:var(--err)}
    @keyframes pulse{0%,100%{opacity:1} 50%{opacity:.3}}
    
    /* Chips (Favorites) */
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:20px;
      border:1px solid var(--border); background:#fff; cursor:pointer; font-size:13px; transition:all .15s ease}
    .chip:hover{box-shadow:var(--shadow)}
    .chip button{background:none; border:none; cursor:pointer; opacity:.6; font-weight:bold}
    .chip button:hover{opacity:1}
    .chip.active{background:var(--accent); color:#fff; border-color:var(--accent)}
    .chip.active button{color:inherit; opacity:.9}
    
    .hidden{display:none !important}
    .divider{height:1px; background:var(--border); margin:16px 0}
    
    /* Output area */
    .output{background:#f8fafc; border:1px solid var(--border); border-radius:8px; padding:16px;
      min-height:200px; font-family:ui-monospace, Monaco, 'Courier New', monospace; font-size:13px;
      white-space:pre-wrap; word-wrap:break-word}
    .output.empty{color:var(--muted); font-style:italic}
    .output h1,.output h2,.output h3,.output h4,.output h5,.output h6{font-weight:700; line-height:1.25}
    .output h1{font-size:1.25rem}
    .output h2{font-size:1.1rem}
    .output h3{font-size:1rem}
    .output h4,.output h5,.output h6{font-size:.95rem}
    
    /* Responsive */
    @media (max-width: 768px) {
      .form-row{grid-template-columns:1fr; gap:8px}
      .nav{flex-direction:column; gap:12px}

    }
  </style>
</head>
<body>
  <!-- Navigation -->
<header>
  <div class="nav">
    <div class="brand">ü§ñ API Manager</div>
    <a class="back-link" href="../index.html" title="Back to Home">‚Üê Back</a>
  </div>
</header>

  <main>
    <!-- API Setup (Configuration) -->
    <section id="config-card" class="card">
      <div class="head">
        <div class="title">API Configuration</div>
        <span class="muted">Set up API keys and models</span>
      </div>

      <!-- Favorites -->
      <div id="favorites-section" class="hidden">
        <div class="head" style="margin-top:0">
          <div class="title" style="font-size:16px">Favorites</div>
        </div>
        <div id="favorite-chips" class="chips"></div>
        <div class="divider"></div>
      </div>

      <!-- Provider & Key -->
      <div class="form-row">
        <div class="form-group">
          <label>Provider</label>
          <select id="provider">
            <option value="openrouter">OpenRouter</option>
            <option value="openai">OpenAI</option>
            <option value="gemini">Gemini</option>
            <option value="grok">Grok</option>
          </select>
        </div>
        <div class="form-group">
          <label>API Key</label>
          <input id="api-key" type="password" placeholder="Paste API key" />
        </div>
        <button class="btn" id="save-key">Save</button>
      </div>

      <!-- OpenRouter Controls -->
      <div class="form-row" id="openrouter-controls">
        <div class="form-group">
          <label>Model</label>
          <select id="model-select">
            <option value="nvidia/nemotron-nano-9b-v2:free">nvidia/nemotron-nano-9b-v2:free</option>
          </select>
        </div>
        <div class="form-group">
          <label style="color:transparent">.</label>
          <div style="display:flex; gap:8px">
            <button class="btn ghost" id="refresh-models">Refresh</button>
            <label style="display:flex; align-items:center; gap:6px; font-size:14px">
              <input type="checkbox" id="only-free" />
              FREE only
            </label>
          </div>
        </div>
        <div class="form-group">
          <label style="color:transparent">.</label>
          <button class="btn ghost" id="toggle-favorite-or" style="width:100%">‚òÜ Favorite</button>
        </div>
      </div>

      <!-- Generic Model Input -->
      <div class="form-row hidden" id="generic-controls">
        <div class="form-group">
          <label>Model</label>
          <input id="model-input" type="text" placeholder="e.g. gpt-4o-mini" />
        </div>
        <div></div>
        <div class="form-group">
          <label style="color:transparent">.</label>
          <button class="btn ghost" id="toggle-favorite-gen" style="width:100%">‚òÜ Favorite</button>
        </div>
      </div>

      <!-- Status -->
      <div class="status" id="api-status">
        <div class="dot"></div>
        <span>Ready</span>
      </div>
    </section>

    <!-- PLAYGROUND lives UNDER the configuration -->
    <section id="playground-card" class="card">
      <div class="head">
        <div class="title">API Playground</div>
        <span class="muted">Test requests using the selected provider, key and model above</span>
      </div>

      <!-- Input -->
      <div class="form-group" style="margin-bottom:16px">
        <label>Input (prompt or JSON)</label>
        <textarea id="input-text" placeholder='Type your prompt or JSON here...

Example prompt:
"Write a very short story about a robot that learns to make coffee"

Example JSON:
{
  "instruction": "Translate to English",
  "text": "Hei verden"
}'></textarea>
      </div>

      <!-- Controls -->
      <div style="display:flex; gap:12px; margin-bottom:16px; flex-wrap:wrap">
        <button class="btn" id="demo-btn">Load demo</button>
        <button class="btn primary" id="send-btn">Send to API</button>
        <button class="btn ghost" id="clear-btn">Clear</button>
        <button class="btn" id="format-toggle-btn" title="Toggle simple formatting">Formatting: On</button>
      </div>

      <!-- Output -->
      <div class="form-group">
        <label>Output</label>
        <div id="output" class="output empty">No output yet. Send a request to the API.</div>
      </div>

      <!-- Status -->
      <div class="status" id="playground-status">
        <div class="dot"></div>
        <span>Ready</span>
      </div>
    </section>
  </main>

  <script>
    // ===============================
    // GENERIC API MANAGER MODULE
    // ===============================
    class GenericAPIManager {
      constructor() {
        this.providers = {
          openrouter: { keyStorage: 'api-key-openrouter', favsStorage: 'api-favs-openrouter' },
          openai: { keyStorage: 'api-key-openai', favsStorage: 'api-favs-openai' },
          gemini: { keyStorage: 'api-key-gemini', favsStorage: 'api-favs-gemini' },
          grok: { keyStorage: 'api-key-grok', favsStorage: 'api-favs-grok' }
        };
        this.currentProvider = 'openrouter';
        this.init();
      }
      init() {
        this.bindEvents();
        this.loadCurrentSettings();
        this.renderFavorites();
      }
      bindEvents() {
        // Provider change
        document.getElementById('provider').addEventListener('change', (e) => {
          this.currentProvider = e.target.value;
          this.loadCurrentSettings();
        });
        // Save key
        document.getElementById('save-key').addEventListener('click', () => {
          this.saveCurrentKey();
        });
        // Refresh models (OpenRouter)
        document.getElementById('refresh-models').addEventListener('click', () => {
          this.refreshModels();
        });
        // Only free
        document.getElementById('only-free').addEventListener('change', () => {
          this.refreshModels();
        });
        // Favorite toggles
        document.getElementById('toggle-favorite-or').addEventListener('click', () => {
          this.toggleFavorite();
        });
        document.getElementById('toggle-favorite-gen').addEventListener('click', () => {
          this.toggleFavorite();
        });
        // Model selection change
        document.getElementById('model-select').addEventListener('change', () => {
          this.updateFavoriteButton();
          this.renderFavorites();
        });
        document.getElementById('model-input').addEventListener('input', () => {
          this.updateFavoriteButton();
          this.renderFavorites();
        });
      }
      setStatus(message, type = 'default') {
        const status = document.getElementById('api-status');
        const span = status.querySelector('span');
        span.textContent = message;
        status.className = 'status' + (type !== 'default' ? ` ${type}` : '');
      }
      loadCurrentSettings() {
        const provider = this.currentProvider;
        // Load saved API key
        const savedKey = this.getStoredKey(provider);
        const keyEl = document.getElementById('api-key');
        keyEl.value = savedKey;
        keyEl.placeholder = this.getKeyPlaceholder(provider);
        // Save button text
        document.getElementById('save-key').textContent = savedKey ? 'Saved' : 'Save';
        // Show/hide controls
        const isOpenRouter = provider === 'openrouter';
        document.getElementById('openrouter-controls').classList.toggle('hidden', !isOpenRouter);
        document.getElementById('generic-controls').classList.toggle('hidden', isOpenRouter);
        if (!isOpenRouter) {
          document.getElementById('model-input').placeholder = this.getModelPlaceholder(provider);
        }
        this.updateFavoriteButton();
        this.renderFavorites();
      }
      getStoredKey(provider) {
        try { return localStorage.getItem(this.providers[provider].keyStorage) || ''; }
        catch { return ''; }
      }
      saveCurrentKey() {
        const key = document.getElementById('api-key').value.trim();
        const provider = this.currentProvider;
        try {
          if (key) {
            localStorage.setItem(this.providers[provider].keyStorage, key);
            this.setStatus('Key saved', 'ok');
          } else {
            localStorage.removeItem(this.providers[provider].keyStorage);
            this.setStatus('Key removed', 'ok');
          }
          document.getElementById('save-key').textContent = key ? 'Saved' : 'Save';
        } catch (e) {
          this.setStatus('Could not save the key', 'error');
        }
      }
      getKeyPlaceholder(provider) {
        const p = {
          openrouter: 'Paste your OpenRouter API key',
          openai: 'Paste your OpenAI API key',
          gemini: 'Paste your Google AI API key',
          grok: 'Paste your Grok (xAI) API key'
        };
        return p[provider] || 'Paste API key';
      }
      getModelPlaceholder(provider) {
        const p = { openai: 'e.g. gpt-4o-mini', gemini: 'e.g. gemini-2.0-flash', grok: 'e.g. grok-2' };
        return p[provider] || 'Type a model name';
      }
      async refreshModels() {
        if (this.currentProvider !== 'openrouter') return;
        const key = this.getStoredKey('openrouter');
        const onlyFree = document.getElementById('only-free').checked;
        const select = document.getElementById('model-select');
        this.setStatus('Fetching models‚Ä¶', 'loading');
        try {
          const headers = key ? { 'Authorization': `Bearer ${key}` } : {};
          const res = await fetch('https://openrouter.ai/api/v1/models', { headers });
          if (!res.ok) throw new Error('Failed to fetch models');
          const data = await res.json();
          let models = (data?.data || []).map(m => m.id).filter(Boolean);
          if (onlyFree) models = models.filter(id => id.includes(':free'));
          // Sort: free first, then A‚ÄìZ
          models.sort((a,b)=>{
            const af=a.includes(':free'), bf=b.includes(':free');
            if (af && !bf) return -1; if (!af && bf) return 1;
            return a.localeCompare(b);
          });
          const current = select.value;
          select.innerHTML = '';
          models.slice(0,200).forEach(id=>{
            const opt=document.createElement('option'); opt.value=id; opt.textContent=id; select.appendChild(opt);
          });
          if (current && models.includes(current)) select.value=current;
          this.setStatus(`Found ${models.length} models`, 'ok');
          this.updateFavoriteButton();
        } catch (err) {
          this.setStatus(err.message || 'Error fetching models', 'error');
        }
      }
      getCurrentModel() {
        return this.currentProvider === 'openrouter'
          ? document.getElementById('model-select').value
          : document.getElementById('model-input').value.trim();
      }
      getFavorites() {
        try { return JSON.parse(localStorage.getItem(this.providers[this.currentProvider].favsStorage) || '[]'); }
        catch { return []; }
      }
      setFavorites(favs) {
        try { localStorage.setItem(this.providers[this.currentProvider].favsStorage, JSON.stringify(favs)); }
        catch {}
      }
      toggleFavorite() {
        const model = this.getCurrentModel();
        if (!model) return;
        const favs = this.getFavorites();
        const idx = favs.indexOf(model);
        if (idx === -1) { favs.push(model); this.setStatus('Added to favorites', 'ok'); }
        else { favs.splice(idx,1); this.setStatus('Removed from favorites', 'ok'); }
        this.setFavorites(favs);
        this.renderFavorites();
        this.updateFavoriteButton();
      }
      updateFavoriteButton() {
        const model = this.getCurrentModel();
        const isFav = model && this.getFavorites().includes(model);
        const orBtn = document.getElementById('toggle-favorite-or');
        const genBtn = document.getElementById('toggle-favorite-gen');
        if (this.currentProvider === 'openrouter') {
          orBtn.textContent = isFav ? '‚òÖ Favorite' : '‚òÜ Favorite';
          orBtn.disabled = !model;
        } else {
          genBtn.textContent = isFav ? '‚òÖ Favorite' : '‚òÜ Favorite';
          genBtn.disabled = !model;
        }
        const label = model ? `Selected model: ${model}${isFav ? ' ‚òÖ' : ''}` : 'No model selected';
        this.setStatus(label, model ? 'ok' : 'default');
      }
      renderFavorites() {
        const favs = this.getFavorites();
        const container = document.getElementById('favorite-chips');
        const section = document.getElementById('favorites-section');
        if (favs.length === 0) { section.classList.add('hidden'); return; }
        section.classList.remove('hidden');
        container.innerHTML = '';
        const currentModel = this.getCurrentModel();
        favs.forEach(model => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          if (model === currentModel) chip.classList.add('active');
          chip.innerHTML = `<span>${model}</span><button type="button">√ó</button>`;
          chip.addEventListener('click',(e)=>{
            if (e.target.tagName === 'BUTTON') return;
            if (this.currentProvider === 'openrouter') document.getElementById('model-select').value = model;
            else document.getElementById('model-input').value = model;
            this.updateFavoriteButton(); this.renderFavorites();
          });
          chip.querySelector('button').addEventListener('click',(e)=>{
            e.stopPropagation();
            const nf = this.getFavorites().filter(f => f !== model);
            this.setFavorites(nf); this.renderFavorites(); this.updateFavoriteButton();
          });
          container.appendChild(chip);
        });
      }
      // === API CALLS ===
      async callAPI(prompt) {
        const provider = this.currentProvider;
        const key = this.getStoredKey(provider);
        const model = this.getCurrentModel();
        if (!key) throw new Error('No API key found for ' + provider);
        if (!model) throw new Error('No model selected');
        switch (provider) {
          case 'openrouter': return this.callOpenRouter(key, model, prompt);
          case 'openai':     return this.callOpenAI(key, model, prompt);
          case 'gemini':     return this.callGemini(key, model, prompt);
          case 'grok':       throw new Error('Grok support coming soon');
          default:           throw new Error('Unknown provider: ' + provider);
        }
      }
      async callOpenRouter(apiKey, model, prompt) {
        const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`,
            'HTTP-Referer': window.location.origin,
            'X-Title': 'Generic API Manager'
          },
          body: JSON.stringify({
            model,
            messages: [
              { role: 'system', content: 'You are a helpful assistant that replies in English.' },
              { role: 'user', content: prompt }
            ]
          })
        });
        if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
        const data = await res.json();
        return data?.choices?.[0]?.message?.content || 'No content from API';
      }
      async callOpenAI(apiKey, model, prompt) {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
          body: JSON.stringify({
            model,
            messages: [
              { role: 'system', content: 'You are a helpful assistant that replies in English.' },
              { role: 'user', content: prompt }
            ]
          })
        });
        if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
        const data = await res.json();
        return data?.choices?.[0]?.message?.content || 'No content from API';
      }
      async callGemini(apiKey, model, prompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(model)}:generateContent`;
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'x-goog-api-key': apiKey },
          body: JSON.stringify({ contents: [{ role: 'user', parts: [{ text: prompt }] }] })
        });
        if (!res.ok) { const t = await res.text(); throw new Error(`HTTP ${res.status}: ${t}`); }
        const data = await res.json();
        const parts = data?.candidates?.[0]?.content?.parts || [];
        return parts.map(p => p.text || '').join('').trim() || 'No content from API';
      }
    }



    // ===============================
    // PLAYGROUND
    // ===============================
    function initPlayground(apiManager) {
      const inputEl = document.getElementById('input-text');
      const outputEl = document.getElementById('output');
      const statusEl = document.getElementById('playground-status');
      const sendBtn = document.getElementById('send-btn');
      const demoBtn = document.getElementById('demo-btn');
      const clearBtn = document.getElementById('clear-btn');
      const formatToggleBtn = document.getElementById('format-toggle-btn');

      let isFormatted = true;
      let lastContent = '';

      function setPlaygroundStatus(message, type = 'default') {
        const span = statusEl.querySelector('span');
        span.textContent = message;
        statusEl.className = 'status' + (type !== 'default' ? ` ${type}` : '');
      }
      function updateFormatToggle() {
        formatToggleBtn.textContent = isFormatted ? 'Formatting: On' : 'Formatting: Off';
        formatToggleBtn.title = isFormatted ? 'Showing formatted text' : 'Showing raw text';
      }
      function escapeHtml(s) {
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      }
      function setOutput(content, isEmpty=false) {
        lastContent = content;
        if (isEmpty) { outputEl.textContent = content; outputEl.classList.add('empty'); return; }
        outputEl.classList.remove('empty');
        if (isFormatted) outputEl.innerHTML = formatOutput(content);
        else outputEl.textContent = content;
      }
      function formatOutput(text) {
        if (!text) return '';
        let formatted = escapeHtml(text)
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/(?<!\*)\*([^*\n]+?)\*(?!\*)/g, '<em>$1</em>')
          .replace(/`([^`\n]+?)`/g, '<code style="background:#f1f5f9;padding:2px 4px;border-radius:3px;font-family:ui-monospace,Monaco,monospace;font-size:13px">$1</code>')
          .replace(/\n/g, '<br>');
        const lines = formatted.split('<br>');
        const out = [];
        let listType = null;
        const close = ()=>{ if (listType){ out.push(listType==='ul' ? '</ul>' : '</ol>'); listType=null; } };
        for (let i=0;i<lines.length;i++){
          const raw = lines[i], line = raw.trim();
          if (line.startsWith('#')){
            let h=0; while(h<line.length && line[h]==='#') h++;
            if (h>0 && h<=6 && line[h]===' '){
              let content = line.slice(h+1).trimEnd();
              while (content.endsWith('#')) content = content.slice(0,-1).trimEnd();
              close(); out.push(`<h${h} style="margin:0 0 8px 0">${content}</h${h}>`); continue;
            }
          }
          if (line==='---' || line==='***' || line==='___'){ close(); out.push('<hr style="border:none;border-top:1px solid var(--border);margin:12px 0">'); continue; }
          if (/^[-*‚Ä¢]\s+/.test(line)){ if (listType!=='ul'){ close(); out.push('<ul>'); listType='ul'; }
            out.push(`<li>${line.replace(/^[-*‚Ä¢]\s+/,'')}</li>`);
          } else if (/^\d+\.\s+/.test(line)){ if (listType!=='ol'){ close(); out.push('<ol>'); listType='ol'; }
            out.push(`<li>${line.replace(/^\d+\.\s+/,'')}</li>`);
          } else { close(); out.push(line ? line + '<br>' : '<br>'); }
        }
        close(); return out.join('');
      }

      // Send
      sendBtn.addEventListener('click', async () => {
        const input = inputEl.value.trim();
        if (!input) { setPlaygroundStatus('Type a prompt first', 'error'); return; }
        sendBtn.disabled = true;
        setPlaygroundStatus('Sending‚Ä¶', 'loading');
        setOutput('Waiting for response‚Ä¶', false);
        try {
          const response = await apiManager.callAPI(input);
          setOutput(response, false);
          setPlaygroundStatus('Response received', 'ok');
        } catch (err) {
          setOutput(`Error: ${err.message}`, false);
          setPlaygroundStatus('API call failed', 'error');
        } finally {
          sendBtn.disabled = false;
        }
      });
      // Demo
// Demo
demoBtn.addEventListener('click', () => {
  const demoPrompt = `You are an expert in cooking and nutrition, with strong skills in creating well-tailored menus with accompanying recipes and shopping lists.
See the section ‚ÄúActual preferences‚Äù and create a menu for the current day that follows the instructions below. You must provide only one answer in the same form as the Output ‚Äì example below.

We use numbering in the output so that an HTML code can later split the content and display it in the correct place.

Output language: English.

Instructions (strict):
- Always follow the output format; do nothing else.
- Day codes (inclusive): 1000‚Äì1006
  1000 = Monday
  1001 = Tuesday
  1002 = Wednesday
  1003 = Thursday
  1004 = Friday
  1005 = Saturday
  1006 = Sunday (explicitly included)
- Row: Provide one or more letters from the locked set {B, L, D, S}, comma-separated in the desired order (e.g., B,D).
  2000 B = Breakfast
  3000 L = Lunch
  4000 D = Dinner
  5000 S = Supper
  For each letter you MUST include the three sub-blocks:
    xxx1 = menu name/title
    xxx2 = recipe
    xxx3 = shopping list
  (Example: for B you will output 2001/2002/2003; for D you will output 3001/3002/3003.)
- Output order is mandatory:
  1) Day line (100x + weekday)
  2) Each Row section in exactly the same order you listed in Row (e.g., B then D), and for each section: base line (2000/3000/4000/5000 + letter) followed by xxx1, xxx2, xxx3.
- Only use letters from {B, L, D, S}; other letters are not allowed.
- Keep measurements metric and temperatures in ¬∞C unless the preferences specify otherwise.

Note: 8000 User preferences
[User given text input]. Apply this knowledge to the menu.

System: 9000
Here we will add the menus generated, andthis will be used as an input later to avoid duplication. Show lines with Menu headlines from the xxx1 series, and (day, letter) after the title. Se example. Do not skip this one.

Actual preferences:
1000
B, D
8000 ‚ÄúNo milk‚Äù

Output ‚Äì example:
1000 Monday
2000 B
2001 Eggs and ham
2002 Recipe
Ingredients (1 serving)
‚Ä¢ 2 eggs
‚Ä¢ 50‚Äì70 g diced ham
‚Ä¢ 1 tsp butter or oil
‚Ä¢ Salt & pepper
‚Ä¢ Optional: chives, grated cheese, toast
Method
1. Heat a nonstick pan over medium heat; add butter.
2. Add ham and saut√© 1‚Äì2 minutes until lightly browned.
3. Beat eggs with a pinch of salt and pepper.
4. Lower heat, pour in eggs, and gently stir with a spatula, pushing curds from edges to center.
5. Cook 60‚Äì90 seconds until just set (still glossy).
6. Remove from heat, fold in cheese/chives if using, and serve on toast.
Tip: For a fried version, simply fry the eggs sunny-side or over-easy and serve on top of the browned ham.

2003 Shopping list
‚Ä¢ Eggs (6-pack)
‚Ä¢ Diced ham (100‚Äì150 g)
‚Ä¢ Butter or cooking oil
‚Ä¢ Bread for toast
‚Ä¢ Salt & black pepper
Optional
‚Ä¢ Chives
‚Ä¢ Grated cheese (e.g., cheddar)

4000 D
4001 Quick Salmon & Potatoes
4002 Recipe
Ingredients (1 serving)
‚Ä¢ 200 g salmon fillet (skin-on)
‚Ä¢ 250 g baby potatoes (or 2 small), halved
‚Ä¢ 1 tbsp olive oil, divided
‚Ä¢ 1 tsp butter (optional)
‚Ä¢ 1 small garlic clove, minced (optional)
‚Ä¢ Lemon wedge
‚Ä¢ Salt & pepper
‚Ä¢ Optional: fresh dill or parsley
Method
1. Boil potatoes in salted water until just tender (10‚Äì12 min); drain well.
2. Heat half the oil in a pan; add potatoes, press lightly to ‚Äúsmash,‚Äù and fry 4‚Äì6 min, turning, until golden. Season. Add garlic for the last minute.
3. Push potatoes to one side; add remaining oil/butter. Season salmon and place skin-side down; cook 3‚Äì4 min until skin is crisp, then flip 1‚Äì2 min until just medium and flaky.
4. Squeeze lemon over, scatter herbs, and serve with the potatoes.
Tip: One-pan oven option‚Äîroast potatoes at 220¬∞C for 20 min, then add salmon and roast 8‚Äì12 min more until it flakes easily.

4003 Shopping list
‚Ä¢ Salmon fillet (200‚Äì400 g)
‚Ä¢ Baby potatoes (250‚Äì500 g)
‚Ä¢ Olive oil
‚Ä¢ Lemon (1)
‚Ä¢ Salt & black pepper
Optional
‚Ä¢ Butter
‚Ä¢ Garlic (1 clove)
‚Ä¢ Fresh dill or parsley

9000 System
- Eggs and ham (1000, B)
- Quick Salmon & Potatoes (1000, D)`;

  inputEl.value = demoPrompt;
  setPlaygroundStatus('Demo prompt loaded', 'ok');
});

      // Clear
      clearBtn.addEventListener('click', () => {
        inputEl.value = ''; lastContent = '';
        setOutput('No output yet. Send a request to the API.', true);
        setPlaygroundStatus('Cleared', 'ok');
      });
      // Toggle formatting
      formatToggleBtn.addEventListener('click', () => {
        isFormatted = !isFormatted; updateFormatToggle();
        if (lastContent) setOutput(lastContent, false);
        setPlaygroundStatus(isFormatted ? 'Showing formatted text' : 'Showing raw text', 'ok');
      });
      updateFormatToggle();
    }

    // ===============================
    // INIT
    // ===============================
    document.addEventListener('DOMContentLoaded', () => {
      const apiManager = new GenericAPIManager();
      initPlayground(apiManager);
      if (apiManager.currentProvider === 'openrouter') {
        setTimeout(() => apiManager.refreshModels(), 400);
      }
    });
  </script>
</body>
</html>

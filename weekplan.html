<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weekplan.ai — Forbedret Ukeplanner</title>
  <style>
    :root {
      --bg: #f8fafc;
      --panel: #ffffff;
      --text: #1a202c;
      --muted: #718096;
      --accent: #4299e1;
      --success: #48bb78;
      --warning: #ed8936;
      --error: #e53e3e;
      --border: #e2e8f0;
      --shadow: 0 10px 25px rgba(0,0,0,0.1);
      --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
    body{background:#f8fafc;color:var(--text);line-height:1.6}
    .container{max-width:1800px;margin:0 auto;padding:20px}

    /* Header */
    .header{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:var(--radius);padding:20px;margin-bottom:30px;box-shadow:var(--shadow)}
    .nav{display:flex;justify-content:space-between;align-items:center}
    .brand{font-size:28px;font-weight:800;background:linear-gradient(45deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .status-badge{padding:8px 16px;border-radius:20px;font-size:14px;font-weight:600;background:var(--success);color:#fff}

    /* Cards */
    .card{background:var(--panel);border-radius:var(--radius);padding:30px;margin-bottom:30px;box-shadow:var(--shadow);transition:var(--transition)}
    .card:hover{box-shadow:var(--shadow-hover);transform:translateY(-2px)}
    .card-title{font-size:24px;font-weight:700;margin:0 0 20px 0;color:var(--text)}

    /* Week Layout */
    .week-container{display:grid;grid-template-columns:repeat(7,1fr);gap:16px}
    @media (max-width:1600px){.week-container{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:1200px){.week-container{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:900px){.week-container{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:600px){.week-container{grid-template-columns:1fr}}

    .day-card{background:var(--panel);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);transition:var(--transition);min-height:120px;min-width:0}
    .day-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-hover)}

    .day-header{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border)}
    .day-title{font-size:16px;font-weight:700;color:var(--text);margin:0;flex:1}

    .btn{padding:10px 14px;border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:var(--transition);font-size:14px}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-primary{background:linear-gradient(45deg,var(--accent),#667eea);color:#fff;box-shadow:0 4px 15px rgba(66,153,225,.3)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(66,153,225,.4)}
    .btn-alt{background:#f7fafc;color:#4299e1;border:1px solid #e2e8f0}
    .btn-alt:hover{background:#edf2f7;border-color:#cbd5e0}

    .day-empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60px;color:var(--muted);font-style:italic;font-size:12px}
    .day-empty svg{width:24px;height:24px;margin-bottom:6px;opacity:.5}

    /* Meal tiles (samme som før, forkortet litt her) */
    .meal-tile{background:#fff;border-radius:16px;overflow:visible;box-shadow:0 4px 12px rgba(0,0,0,.1);transition:all .3s cubic-bezier(.25,.46,.45,.94);margin-bottom:12px;position:relative}
    .meal-tile:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,.15)}
    .meal-header{position:relative;height:60px;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;color:#fff;border-radius:16px 16px 0 0;overflow:hidden}
    .meal-header.breakfast{background:linear-gradient(135deg,#ff9a56 0%,#ff6b35 100%)}
    .meal-header.lunch{background:linear-gradient(135deg,#48bb78 0%,#38a169 100%)}
    .meal-header.dinner{background:linear-gradient(135deg,#4299e1 0%,#3182ce 100%)}
    .meal-header.supper{background:linear-gradient(135deg,#9f7aea 0%,#805ad5 100%)}
    .meal-type-label{font-size:14px;font-weight:600;display:flex;align-items:center;gap:6px}
    .meal-icon{position:absolute;top:45px;left:50%;transform:translateX(-50%);width:50px;height:50px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:2}
    .meal-icon svg{width:24px;height:24px;color:#4a5568}
    .meal-content{padding:35px 16px 16px;text-align:center}
    .meal-title{font-size:16px;font-weight:600;color:#1a202c;margin:0 0 6px 0;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .meal-description{color:#718096;font-size:12px;margin:0 0 12px 0;line-height:1.4}
    .meal-stats{display:flex;justify-content:space-between;margin:8px 0}
    .stat{display:flex;align-items:center;gap:4px;font-size:11px;color:#4a5568;font-weight:500}
    .meal-actions{display:flex;gap:8px;justify-content:center}
    .action-btn{padding:8px 12px;border-radius:12px;font-weight:600;font-size:12px;border:none;cursor:pointer;transition:var(--transition);flex:1}
    .action-btn.secondary{background:#f7fafc;color:#4299e1;border:1px solid #e2e8f0}
    .action-btn.secondary:hover{background:#edf2f7;border-color:#cbd5e0}
    .action-btn.primary{background:#4299e1;color:#fff;box-shadow:0 2px 6px rgba(66,153,225,.3)}
    .action-btn.primary:hover{background:#3182ce;transform:translateY(-1px);box-shadow:0 4px 8px rgba(66,153,225,.4)}

    /* Modal */
    .recipe-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);opacity:0;transition:opacity .2s ease}
    .recipe-popover{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.95);min-width:400px;max-width:700px;width:90vw;max-height:85vh;background:#fff;border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,.3);padding:40px;z-index:1001;opacity:0;transition:all .2s cubic-bezier(.25,.46,.45,.94);overflow-y:auto}
    .recipe-close{position:absolute;top:20px;right:20px;background:#f7fafc;border:none;font-size:24px;cursor:pointer;color:#718096;padding:12px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;transition:var(--transition)}
    .recipe-close:hover{background:#edf2f7;color:#4a5568;transform:scale(1.05)}
    .pre{background:#f8fafc;padding:20px;border-radius:12px;border-left:4px solid var(--accent);white-space:pre-wrap;font-family:ui-sans-serif,system-ui,sans-serif;font-size:15px;line-height:1.6;color:#2d3748}

    .week-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .status-message{padding:12px 16px;border-radius:8px;margin-top:16px;font-weight:600}
    .status-success{background:rgba(72,187,120,.1);color:var(--success);border:1px solid var(--success)}
    .status-error{background:rgba(229,62,62,.1);color:var(--error);border:1px solid var(--error)}

    @keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .animate-in{animation:slideIn .5s ease-out}

    /* meal type color dots (ikke essensielt men greit å beholde) */
    .meal-slot[data-meal="B"] .meal-type{color:#ed8936}
    .meal-slot[data-meal="L"] .meal-type{color:#48bb78}
    .meal-slot[data-meal="D"] .meal-type{color:#4299e1}
    .meal-slot[data-meal="S"] .meal-type{color:#9f7aea}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <nav class="nav">
        <h1 class="brand">Weekplan.ai</h1>
        <div class="status-badge" id="status-badge">Klar</div>
      </nav>
    </header>

    <!-- Week Plan -->
    <section class="card">
      <h2 class="card-title">📅 Din Ukeplan</h2>
      <div id="weekContainer" class="week-container"></div>
      <div id="statusMessage"></div>
    </section>

    <!-- System Info -->
    <details class="card">
      <summary style="cursor:pointer;font-weight:600">🔧 System Info</summary>
      <div id="systemInfo" class="pre">Ingen data ennå...</div>
    </details>
  </div>

  <script type="module">
    // --- (1) Forsøk å importere DEMO_PROMPT hvis du har denne filen i prosjeketet ---
    let DEMO_PROMPT = undefined;
    try {
      const mod = await import('/tools/menuDemoPrompt.js');
      DEMO_PROMPT = mod?.DEMO_PROMPT;
    } catch (_) {
      // Stilletiende – vi håndterer fallback senere.
    }

    // --- (2) Dag- og måltids-mapping ---
    const dayMapping = {
      1000: { name: 'Mandag', short: 'Man' },
      1001: { name: 'Tirsdag', short: 'Tir' },
      1002: { name: 'Onsdag', short: 'Ons' },
      1003: { name: 'Torsdag', short: 'Tor' },
      1004: { name: 'Fredag', short: 'Fre' },
      1005: { name: 'Lørdag', short: 'Lør' },
      1006: { name: 'Søndag', short: 'Søn' }
    };
    const mealMapping = { B:'Frokost', L:'Lunsj', D:'Middag', S:'Kveldsmat' };

    // --- (3) UI helpers ---
    function showStatus(message, type='success'){
      const statusEl = document.getElementById('statusMessage');
      const badgeEl = document.getElementById('status-badge');
      statusEl.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
      badgeEl.textContent = (type==='success') ? '✅ Klar' : '❌ Feil';
      badgeEl.className = `status-badge ${type}`;
    }

        // --- (4) Bygg uke-grid (med spesialknapper på Mandag) ---
    function initializeWeek(){
      const container = document.getElementById('weekContainer');
      if (!container) return;
      container.innerHTML = '';

      Object.entries(dayMapping).forEach(([code, day]) => {
        const isMonday = code === '1000';

        const card = document.createElement('div');
        card.className = 'day-card animate-in';
        card.setAttribute('data-day-code', code); // viktig for renderMonday-selector

        card.innerHTML = `
          <div class="day-header">
            <h3 class="day-title">${day.name}</h3>
            ${isMonday ? `
              <div style="display:flex;gap:8px">
                <button
                  class="btn btn-primary"
                  data-action="gen-monday"
                  aria-label="Generer mandag"
                  title="Generer mandag"
                  style="padding:8px; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;"
                >▶</button>
              </div>
            ` : ``}

          </div>
          <div class="day-content">
            <div class="day-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              Ingen måltider planlagt
            </div>
          </div>
        `;

        container.appendChild(card);

        // Koble knapper (kun Mandag) etter at elementene finnes
        if (isMonday) {
          const genBtn = card.querySelector('[data-action="gen-monday"]');
          const resetBtn = card.querySelector('[data-action="reset-monday"]');
          if (genBtn) genBtn.addEventListener('click', (e) => generateMonday(e.currentTarget));
          if (resetBtn) resetBtn.addEventListener('click', () => refreshDay('1000'));
        }
      });

      showStatus('Uke er klar. Trykk «Generer mandag».', 'success');
    }

    // Eksponer funksjonen globalt
    window.initializeWeek = initializeWeek;


    // --- (5) Parser (samme logikk som før) ---
    function parseAIOutput(text){
      const lines = text.trim().split('\n');
      const result = {};
      let currentDay = null;
      let currentMeal = null;
      let currentSection = null;

      lines.forEach((rawLine, idx) => {
        let line = rawLine.trim();
        if (!line) return;

        // Day
        const dayMatch = line.match(/^(100[0-6])\s+(.+)$/);
        if (dayMatch){
          currentDay = dayMatch[1];
          result[currentDay] = { name: dayMatch[2], meals: {} };
          currentMeal = null;
          currentSection = null;
          return;
        }

        // Meal
        const mealMatch = line.match(/^([2-5])000\s+([BLDS])$/);
        if (mealMatch && currentDay){
          currentMeal = mealMatch[2];
          result[currentDay].meals[currentMeal] = {};
          currentSection = null;
          return;
        }

        // Content 2001/2002/2003
        const contentMatch = line.match(/^([2-5])00([1-3])\s+(.+)$/);
        if (contentMatch && currentDay && currentMeal){
          const section = contentMatch[2];
          const content = contentMatch[3];
          if (section === '1'){
            result[currentDay].meals[currentMeal].title = content;
          } else if (section === '2'){
            result[currentDay].meals[currentMeal].recipe = [content];
            currentSection = 'recipe';
          } else if (section === '3'){
            result[currentDay].meals[currentMeal].shopping = [content];
            currentSection = 'shopping';
          }
          return;
        }

        // Continuation
        if (currentDay && currentMeal && currentSection && line){
          const meal = result[currentDay].meals[currentMeal];
          if (currentSection === 'recipe' && meal.recipe){
            meal.recipe.push(line);
          } else if (currentSection === 'shopping' && meal.shopping){
            meal.shopping.push(line);
          }
        }

        // System (9000)
        if (line.startsWith('9000')){
          result.system = lines.slice(idx + 1).join('\n');
        }
      });

      return result;
    }

    // --- (6) Render kun én dag (mandag) ---
    function renderMonday(data){
      const monday = data['1000'];
      const card = document.querySelector('[data-day-code="1000"]');
      if (!card) return;
      const dayContent = card.querySelector('.day-content');
      if (!monday || !monday.meals || Object.keys(monday.meals).length === 0){
        // behold tom state
        return;
      }
      dayContent.innerHTML = '';

      const mealsHtml = Object.entries(monday.meals).map(([mealCode, mealData]) => {
        const mealType = getMealTypeClass(mealCode);
        const mealIcon = getMealIcon(mealCode);
        const recipeData = JSON.stringify(mealData.recipe || []);
        const shoppingData = JSON.stringify(mealData.shopping || []);
        const titleData = mealData.title || 'Ukjent måltid';
        return `
          <div class="meal-tile" data-meal="${mealCode}"
               data-recipe='${recipeData}'
               data-shopping='${shoppingData}'
               data-title='${titleData}'>
            <div class="meal-header ${mealType}">
              <div class="meal-type-label">
                ${mealMapping[mealCode] || 'Måltid'}
                <svg class="meal-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </div>
              <svg class="meal-heart" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
            </div>
            <div class="meal-icon">${mealIcon}</div>
            <div class="meal-content">
              <h3 class="meal-title">${titleData}</h3>
              <p class="meal-description">Frisk, lett og proteinrik</p>
              <div class="meal-stats">
                <div class="stat">
                  <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                  </svg> 25 min
                </div>
                <div class="stat">
                  <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                  </svg> 2 pers
                </div>
                <div class="stat">
                  <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                  </svg> Lett
                </div>
              </div>
              <div class="meal-actions">
                <button class="action-btn secondary" onclick="showShoppingFromElement(this)">Handleliste</button>
                <button class="action-btn primary" onclick="showRecipeFromElement(this)">Oppskrift</button>
              </div>
            </div>
          </div>
        `;
      }).join('');

      dayContent.innerHTML = mealsHtml;

      // Systemtekst hvis finnes
      if (data.system){
        document.getElementById('systemInfo').textContent = data.system;
      }
    }

    function getMealTypeClass(mealCode){
      return ({B:'breakfast',L:'lunch',D:'dinner',S:'supper'})[mealCode] || 'breakfast';
    }
    function getMealIcon(mealCode){
      const iconMap = {
        B:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20m8-10H4"/></svg>`,
        L:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>`,
        D:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6.13 1L6 16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V1"/><path d="M1 6h22"/></svg>`,
        S:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>`
      };
      return iconMap[mealCode] || iconMap.B;
    }

    // --- (7) Modal + helpers (samme som før) ---
    function showModal(title, sections){
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div class="recipe-backdrop" onclick="closeModal()"></div>
        <div class="recipe-popover">
          <button class="recipe-close" onclick="closeModal()">×</button>
          <div class="recipe-content">
            <h2 style="margin-top:0;color:#1a202c;font-size:28px;font-weight:800;">${title}</h2>
            ${sections.map(s=>`
              <div class="recipe-section">
                <h4 style="display:flex;gap:12px;align-items:center;color:var(--accent);font-size:20px;font-weight:700;margin:0 0 16px 0">
                  ${s.icon}${s.title}
                </h4>
                <div class="pre">${s.content}</div>
              </div>
            `).join('')}
          </div>
        </div>`;
      modal.className='recipe-modal';
      Object.assign(modal.style,{position:'fixed',inset:'0',zIndex:'1000'});
      document.body.appendChild(modal);
      document.body.style.overflow='hidden';
      setTimeout(()=>{
        modal.querySelector('.recipe-backdrop').style.opacity='1';
        const pop = modal.querySelector('.recipe-popover');
        pop.style.opacity='1'; pop.style.transform='translate(-50%,-50%) scale(1)';
      },10);
    }
    window.closeModal = function(){
      const modal=document.querySelector('.recipe-modal'); if(!modal) return;
      const backdrop=modal.querySelector('.recipe-backdrop'); const pop=modal.querySelector('.recipe-popover');
      backdrop.style.opacity='0'; pop.style.opacity='0'; pop.style.transform='translate(-50%,-50%) scale(.95)';
      setTimeout(()=>{ modal.remove(); document.body.style.overflow=''; },200);
    }
    window.showRecipeFromElement = (el)=>{
      const tile=el.closest('.meal-tile'); if(!tile) return;
      const title=tile.getAttribute('data-title');
      const recipe=JSON.parse(tile.getAttribute('data-recipe')||'[]');
      showModal(title,[{title:'Oppskrift',icon:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,content:recipe.length?recipe.join('\n'):'Ingen oppskrift tilgjengelig'}]);
    };
    window.showShoppingFromElement = (el)=>{
      const tile=el.closest('.meal-tile'); if(!tile) return;
      const title=tile.getAttribute('data-title');
      const shopping=JSON.parse(tile.getAttribute('data-shopping')||'[]');
      showModal(title,[{title:'Handleliste',icon:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h2l.4 2M7 13h10l4-8H5.4m1.6 8L6 5H3m4 8v6a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-6m-8 6h.01M16 19h.01"/></svg>`,content:shopping.length?shopping.join('\n'):'Ingen handleliste tilgjengelig'}]);
    };

    // --- (8) Nullstill én dag ---
    function refreshDay(dayCode){
      const dayCard=document.querySelector(`[data-day-code="${dayCode}"]`);
      if(!dayCard) return;
      const dayContent=dayCard.querySelector('.day-content');
      dayContent.innerHTML=`
        <div class="day-empty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          Ingen måltider planlagt
        </div>`;
      showStatus(`🔄 ${dayMapping[dayCode]?.name || 'Dag'} har blitt nullstilt`);
    }
    window.refreshDay = refreshDay;

    // --- (9) API-bridge for demo-prompt ---
    async function runDemoViaApiManager(){
    // A) Bruk weekplan-bridge (unngår navnekonflikt med API Manager-UI)
    if (window.WeekplanBridge?.runDemoPrompt){
      const out = await window.WeekplanBridge.runDemoPrompt(); // forventer ren tekst
      return out;
    }


      // B) Prøv backend-proxy med importert DEMO_PROMPT:
      if (DEMO_PROMPT){
        const res = await fetch('/api/run-demo', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ prompt: DEMO_PROMPT })
        });
        if (!res.ok) throw new Error('API svarte ikke OK');
        const data = await res.text(); // anta ren tekst
        return data;
      }

      // C) Fallback: liten hardkodet demo kun for mandag (1000 + middag D)
      return [
        '1000 Monday',
        '2000 D',
        '2001 Salmon with Roasted Potatoes',
        '2002 Recipe',
        'Preheat oven to 200°C.',
        'Toss potato wedges with olive oil, salt, pepper; roast 25 min.',
        'Season salmon; bake last 12–15 min.',
        'Serve with lemon and a green salad.',
        '2003 Shopping list',
        'Salmon fillets (2)',
        'Potatoes (600 g)',
        'Olive oil, salt, pepper, lemon',
        'Mixed greens'
      ].join('\n');
    }

    // --- (10) Generer MANDAG ---
    async function generateMonday(button){
      const originalLabel = button.textContent;
      try{
        button.disabled = true;
        button.textContent = 'Genererer…';
        showStatus('Jobber med å hente meny for mandag …');

        const raw = await runDemoViaApiManager();
        const parsed = parseAIOutput(raw);

        // Sikkerhet: behold kun 1000 (mandag)
        const onlyMonday = {};
        if (parsed['1000']) onlyMonday['1000'] = parsed['1000'];
        if (parsed.system) onlyMonday.system = parsed.system;

        renderMonday(onlyMonday);
        showStatus('✅ Mandag generert fra API', 'success');
      } catch (err){
        console.error(err);
        showStatus('❌ Klarte ikke å generere mandag. Sjekk API-koblingen.', 'error');
      } finally{
        button.disabled = false;
        button.textContent = originalLabel;
      }
    }
  </script>

  <!-- last scripts -->
  <script type="module" src="/tools/weekplan-bridge.js"></script>
  <script type="module">
    // --- (11) Init ---
    document.addEventListener('DOMContentLoaded', initializeWeek);
  </script>
</body>
</html>
